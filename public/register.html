<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>register</title>
</head>

<body>
    <form id="form">
        <input id="id" name="id" type="hidden">
        <label for="userName">userName:</label>
        <input id="userName" name="userName" type="text">
        <label for="email">email</label>
        <input id="email" name="email" type="text">
        <label for="password">password</label>
        <input id="password" name="password" type="password">
        <label for="password2">password again</label>
        <input id="password2" name="password2" type="password">
        <input id="task" name="task" type="hidden">

        <button type="submit">submit</button>
    </form>
    <a href="login">Login</a>
    
    <script>
        // ==============================================================================================
      
        function loadDataBase()
        {
            const xhttp = new XMLHttpRequest();
            const retValue=null;
            xhttp.onload =()=>
            {
                if(xhttp.status>=200 && xhttp.status<300)
                {
                   const response = JSON.parse(xhttp.response);
                   const lastUser=response[Object.keys(response)[Object.keys(response).length - 1]];
                   retValue = lastUser;

                }
            }

            xhttp.open("get","/loaddata/register",true);
            xhttp.send();
            return retValue;
        }

  

  
        // ================================
        const form = document.forms[0];



        function autoIncremment()
      {
       const getID=loadDataBase();
       console.log(getID);
      }

      autoIncremment();



        form.addEventListener("submit", function (event) {
            event.preventDefault();
            new FormData(form);
        });

        form.addEventListener("formdata", (event) => {
            const data = event.formData;

            const values = [...data.values()];
           
            const id = Math.random() * 4;
            const userName = values[1];
            const email = values[2];
            const password = values[3];
            const password2 = values[4];;
            const task = values[5];
            
            // console.log(task);
            const xhttp = new XMLHttpRequest();

            if (
                userName === null ||
                userName === "" ||
                email === null ||
                email === "" ||
                password === null ||
                password === "" ||
                password2 === null ||
                password2 === ""
            ) {
                alert("fields can not be empty");
                return false;
            } else if (
                ValidateName(userName) &&
                ValidateEmail(email) &&
                comparePasswords(password, password2)
            ) {
                xhttp.open("post", "/addUser", true);
                xhttp.setRequestHeader("content-type", "application/json");
                xhttp.send(JSON.stringify({ id, userName, email, password,task }));
                alert("you are successfuly registered, please use the login button.");
                window.location.href = "login";
            } else {
                ("please try again");
            }
        });

        // ----------------------------------------------------
        // ----------------------------------------------------
        function ValidateName(name) {
            if (/^[a-zA-Z0-9]+$/.test(name)) {
                return true;
            } else {
                alert("Name should containt only -'A' or 'a'- to -'Z' or 'z'- and 0 to 9");
                return false;
            }
        }
        // -----------------------------------
        function ValidateEmail(email) {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) {
                return true;
            } else {
                alert("You have entered an invalid Email!");
                return false;
            }
        }
        // -----------------------------------------
        function comparePasswords(password, password2) {
            if (password === password2) {
                return true;
            } else {
                alert("passwords must be the same!");
                return false;
            }
        }
        // ----------------------------------------------------
        // ----------------------------------------------------
        document.getElementById("form").reset();


    </script>
</body>

</html>